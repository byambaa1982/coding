{% extends "base.html" %}

{% block title %}{{ lesson.title }} - Python Exercises{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 24px 16px;">
    <!-- Breadcrumb -->
    <div style="display: flex; gap: 8px; margin-bottom: 24px; font-size: 14px; color: var(--text-secondary);">
        <a href="{{ url_for('main.index') }}" style="color: var(--primary); text-decoration: none;">Home</a>
        <span>/</span>
        <a href="{{ url_for('catalog.course_detail', slug=tutorial.slug) }}" style="color: var(--primary); text-decoration: none;">{{ tutorial.title }}</a>
        <span>/</span>
        <a href="{{ url_for('learning.tutorial_overview', tutorial_id=tutorial.id) }}" style="color: var(--primary); text-decoration: none;">Curriculum</a>
        <span>/</span>
        <span>{{ lesson.title }}</span>
    </div>
    
    <!-- Header -->
    <div style="background: var(--bg-secondary); border-radius: 8px; padding: 24px; margin-bottom: 32px; box-shadow: var(--shadow-sm);">
        <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 12px; color: var(--text-primary);">
            {{ lesson.title }} - Python Exercises
        </h2>
        <p style="color: var(--text-secondary); font-size: 16px;">{{ lesson.description }}</p>
    </div>
    
    {% if exercises %}
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 24px;">
        {% for item in exercises %}
        {% set exercise = item.exercise %}
        <div style="background: var(--bg-secondary); border-radius: 8px; padding: 24px; box-shadow: var(--shadow-sm); display: flex; flex-direction: column;">
            <!-- Header -->
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px;">
                <h5 style="font-size: 18px; font-weight: 600; color: var(--text-primary); flex: 1;">
                    {{ exercise.title }}
                </h5>
                {% if item.has_solved %}
                <span style="background: var(--success); color: white; padding: 4px 12px; border-radius: 4px; font-size: 13px; font-weight: 500;">
                    âœ“ Solved
                </span>
                {% endif %}
            </div>
            
            <!-- Description -->
            <p style="color: var(--text-secondary); margin-bottom: 16px; line-height: 1.6;">
                {{ exercise.description|truncate(150) }}
            </p>
            
            <!-- Metadata -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <span style="background: {% if exercise.difficulty == 'easy' %}var(--success){% elif exercise.difficulty == 'medium' %}var(--warning){% else %}var(--danger){% endif %}; color: white; padding: 4px 12px; border-radius: 4px; font-size: 12px; font-weight: 600; text-transform: uppercase;">
                    {{ exercise.difficulty }}
                </span>
                <small style="color: var(--text-secondary); font-weight: 500;">{{ exercise.points }} points</small>
            </div>
            
            <!-- Progress Bar -->
            {% if item.best_score > 0 %}
            <div style="margin-bottom: 16px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px;">
                    <span style="color: var(--text-secondary);">Best Score</span>
                    <span style="font-weight: 600; color: {% if item.best_score == 100 %}var(--success){% else %}var(--warning){% endif %};">
                        {{ item.best_score }}%
                    </span>
                </div>
                <div style="width: 100%; background: var(--bg-tertiary); border-radius: 4px; height: 8px; overflow: hidden;">
                    <div style="height: 100%; background: {% if item.best_score == 100 %}var(--success){% else %}var(--warning){% endif %}; width: {{ item.best_score }}%; transition: width 0.3s;"></div>
                </div>
            </div>
            {% endif %}
            
            <!-- Stats -->
            <div style="display: flex; gap: 16px; margin-bottom: 16px; font-size: 13px; color: var(--text-secondary);">
                <span><i class="fas fa-code"></i> {{ item.attempt_count }} attempts</span>
                {% if item.last_attempt %}
                <span><i class="fas fa-clock"></i> Last: {{ item.last_attempt.strftime('%m/%d %H:%M') }}</span>
                {% endif %}
            </div>
            
            <!-- Action Button -->
            <a href="{{ url_for('python_practice.view_exercise', exercise_id=exercise.id) }}" 
               class="btn btn-primary" 
               style="margin-top: auto; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px;">
                <i class="fas fa-play"></i>
                {% if item.has_solved %}Try Again{% else %}Start Exercise{% endif %}
            </a>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 64px 16px; color: var(--text-secondary);">
        <i class="fas fa-code" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;"></i>
        <p style="font-size: 18px;">No exercises available for this lesson yet.</p>
        <a href="{{ url_for('learning.tutorial_overview', tutorial_id=tutorial.id) }}" 
           class="btn btn-primary" 
           style="margin-top: 16px;">
            <i class="fas fa-arrow-left"></i> Back to Curriculum
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}
