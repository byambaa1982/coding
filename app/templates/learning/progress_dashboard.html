{% extends "base.html" %}

{% block title %}Progress Dashboard{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-8">My Learning Progress</h1>

    <!-- Statistics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm">Total Courses</p>
                    <p class="text-3xl font-bold text-blue-600">{{ total_courses }}</p>
                </div>
                <div class="text-blue-600">
                    <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm">Completed</p>
                    <p class="text-3xl font-bold text-green-600">{{ completed_courses }}</p>
                </div>
                <div class="text-green-600">
                    <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm">Lessons Completed</p>
                    <p class="text-3xl font-bold text-purple-600">{{ total_lessons_completed }}</p>
                </div>
                <div class="text-purple-600">
                    <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"></path>
                    </svg>
                </div>
            </div>
        </div>

        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-gray-600 text-sm">Day Streak</p>
                    <p class="text-3xl font-bold text-orange-600">{{ streak }}</p>
                </div>
                <div class="text-orange-600">
                    <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z"></path>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <!-- Enrolled Courses -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
        <div class="lg:col-span-2">
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-bold mb-6">My Courses</h2>
                
                {% if enrollments %}
                <div class="space-y-4">
                    {% for enrollment in enrollments %}
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h3 class="font-semibold text-lg mb-1">
                                    <a href="{{ url_for('learning.tutorial_overview', tutorial_id=enrollment.tutorial.id) }}" 
                                       class="hover:text-blue-600">
                                        {{ enrollment.tutorial.title }}
                                    </a>
                                </h3>
                                <p class="text-sm text-gray-600">
                                    {{ enrollment.tutorial.course_type|upper }} • 
                                    {{ enrollment.tutorial.difficulty_level|capitalize }}
                                </p>
                            </div>
                            {% if enrollment.is_completed %}
                            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">
                                Completed
                            </span>
                            {% endif %}
                        </div>
                        
                        <div class="mb-2">
                            <div class="flex justify-between text-sm text-gray-600 mb-1">
                                <span>Progress</span>
                                <span>{{ "%.1f"|format(enrollment.progress_percentage) }}%</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full transition-all" 
                                     style="width: {{ enrollment.progress_percentage }}%"></div>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between text-sm text-gray-600">
                            <span>{{ enrollment.lessons_completed }}/{{ enrollment.tutorial.total_lessons }} lessons</span>
                            <a href="{{ url_for('learning.tutorial_overview', tutorial_id=enrollment.tutorial.id) }}" 
                               class="text-blue-600 hover:text-blue-700">
                                Continue →
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-12">
                    <svg class="w-20 h-20 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"></path>
                    </svg>
                    <p class="text-gray-600 mb-4">You haven't enrolled in any courses yet.</p>
                    <a href="{{ url_for('catalog.index') }}" 
                       class="inline-block px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                        Browse Courses
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Sidebar -->
        <div class="lg:col-span-1 space-y-6">
            <!-- Recent Activity -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="font-bold text-lg mb-4">Recent Activity</h3>
                {% if recent_progress %}
                <div class="space-y-3">
                    {% for progress in recent_progress[:5] %}
                    <div class="text-sm">
                        <p class="font-medium text-gray-800">{{ progress.lesson.title[:40] }}...</p>
                        <p class="text-gray-600 text-xs">
                            {{ progress.completed_at.strftime('%b %d, %Y') if progress.completed_at else progress.last_accessed_at.strftime('%b %d, %Y') }}
                        </p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-600 text-sm">No recent activity</p>
                {% endif %}
            </div>

            <!-- Bookmarked Lessons -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="font-bold text-lg mb-4">Bookmarked Lessons</h3>
                {% if bookmarked %}
                <div class="space-y-3">
                    {% for progress in bookmarked[:5] %}
                    <div class="text-sm">
                        <a href="{{ url_for('learning.view_lesson', lesson_id=progress.lesson_id) }}" 
                           class="font-medium text-blue-600 hover:text-blue-700">
                            {{ progress.lesson.title[:40] }}...
                        </a>
                        <p class="text-gray-600 text-xs">
                            {{ progress.lesson.tutorial.title[:30] }}...
                        </p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-gray-600 text-sm">No bookmarked lessons</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
